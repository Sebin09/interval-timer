<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interval Timer</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f0f0f">

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(180deg, #0f0f0f, #1a1a1a);
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#setup {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.choiceBtn {
  padding: 12px 40px;
  font-size: 18px;
  border-radius: 40px;
  border: none;
  background: #00ff88;
  color: black;
  font-weight: bold;
}

#app {
  display: none;
  flex-direction: column;
  align-items: center;
}

#total {
  font-size: 24px;
  opacity: 0.7;
  margin-bottom: 10px;
}

#phase {
  font-size: 28px;
  letter-spacing: 2px;
  margin-bottom: 10px;
}

#time {
  font-size: 90px;
  font-weight: bold;
  margin: 10px 0 30px 0;
}

.buttons {
  display: flex;
  gap: 15px;
}

button {
  padding: 12px 30px;
  font-size: 18px;
  border-radius: 40px;
  border: none;
  font-weight: bold;
}

.start { background: #00ff88; color: black; }
.pause { background: #ffaa00; color: black; }
.stop  { background: #ff4444; color: white; }

button:active { transform: scale(0.95); }
</style>
</head>
<body>

<div id="setup">
  <h2>Select Workout Duration</h2>
  <button class="choiceBtn" onclick="selectDuration(10)">10 Minutes</button>
  <button class="choiceBtn" onclick="selectDuration(15)">15 Minutes</button>
  <button class="choiceBtn" onclick="selectDuration(30)">30 Minutes</button>
</div>

<div id="app">
  <div id="total">00:00</div>
  <div id="phase">Ready</div>
  <div id="time">00:00</div>

  <div class="buttons">
    <button class="start" onclick="startTimer()">Start</button>
    <button class="pause" onclick="pauseTimer()">Pause</button>
    <button class="stop" onclick="stopTimer()">Stop</button>
  </div>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

const phases = [
  { name: "Walk", duration: 90 },
  { name: "Run", duration: 60 },
  { name: "Sprint", duration: 30 }
];

let totalWorkoutTime = 0;
let totalTimeLeft = 0;
let phaseIndex = 0;
let phaseTimeLeft = 0;
let timer = null;
let running = false;

function selectDuration(minutes) {
  totalWorkoutTime = minutes * 60;
  totalTimeLeft = totalWorkoutTime;

  document.getElementById("setup").style.display = "none";
  document.getElementById("app").style.display = "flex";

  updateDisplay();
}

function beep() {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  osc.type = "square";
  osc.frequency.setValueAtTime(900, ctx.currentTime);
  osc.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.15);
}

function speak(text) {
  const speech = new SpeechSynthesisUtterance(text);
  window.speechSynthesis.speak(speech);
}

function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return String(m).padStart(2, '0') + ":" + String(s).padStart(2, '0');
}

function updateDisplay() {
  document.getElementById("time").textContent = formatTime(phaseTimeLeft);
  document.getElementById("total").textContent = formatTime(totalTimeLeft);
}

function nextPhase() {
  const current = phases[phaseIndex];
  phaseTimeLeft = current.duration;
  document.getElementById("phase").textContent = current.name;
  beep();
  speak(current.name);
  phaseIndex = (phaseIndex + 1) % phases.length;
}

function tick() {
  if (!running) return;

  totalTimeLeft--;
  phaseTimeLeft--;

  updateDisplay();

  if (totalTimeLeft <= 0) {
    clearInterval(timer);
    running = false;
    document.getElementById("phase").textContent = "Workout Complete";
    beep();
    speak("Workout complete");
    return;
  }

  if (phaseTimeLeft <= 0) {
    nextPhase();
  }
}

function startTimer() {
  if (running) return;
  running = true;

  if (phaseTimeLeft === 0) {
    nextPhase();
  }

  timer = setInterval(tick, 1000);
}

function pauseTimer() {
  running = false;
}

function stopTimer() {
  clearInterval(timer);
  running = false;
  totalTimeLeft = totalWorkoutTime;
  phaseIndex = 0;
  phaseTimeLeft = 0;
  document.getElementById("phase").textContent = "Ready";
  updateDisplay();
}
</script>

</body>
</html>